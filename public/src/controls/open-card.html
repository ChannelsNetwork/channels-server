<link rel="import" href="open-card-header.html">

<dom-module id="open-card">
  <template>
    <style is="custom-style" include="iron-flex iron-flex-alignment">
       :host {
        display: none;
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        width: 100%;
        box-sizing: border-box;
        transition: all 1s ease;
        z-index: 1;
        pointer-events: auto;
      }

      #container {
        width: 100%;
        height: 100%;
        box-sizing: border-box;
        box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
        border-radius: 3px;
        overflow: hidden;
        position: relative;
        background: white;
        @apply --layout-vertical;
        opacity: 0;
        transition: opacity 1s ease;
      }

      #header {
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
        box-sizing: border-box;
        border-radius: 3px 3px 0 0;
        overflow: hidden;
      }

      #headerBuffer {
        display: block;
        box-sizing: border-box;
        height: 60px;
      }

      .animatable {
        transition: all 1s ease;
      }
    </style>
    <div id="container" class="container">
      <div id="headerBuffer"></div>
    </div>
    <open-card-header id="header" data="[[data]]"></open-card-header>
  </template>
  <script>
    class OpenCard extends Polymer.Element {
      static get is() { return "open-card"; }
      static get properties() {
        return {
          data: Object
        };
      }

      open(node) {
        return new Promise((resolve, reject) => {
          this.style.display = "block";
          requestAnimationFrame(() => {
            this.$.header.style.bottom = "initial";
            this.$.header.style.top = (this.offsetHeight - 60) + "px";
            this.$.header.classList.add("animatable");
            requestAnimationFrame(() => {
              this.$.header.style.top = "0px";
              resolve();
            });
            this.$.container.style.opacity = 1;
            let nodeRect = node.getBoundingClientRect();
            let cardRect = this.getBoundingClientRect();
            this.style.top = (nodeRect.top - cardRect.top) + "px";
            this.style.left = (nodeRect.left - cardRect.left) + "px";
            this.style.width = nodeRect.width + "px"
            this.style.height = nodeRect.height + "px";
          });
        });
      }

      close(animate) {
        this.style.display = "none";
        this.$.header.style.bottom = "0";
        this.$.header.style.top = "initial"
        this.$.header.classList.remove("animatable");
        this.$.container.style.opacity = 0;
        this.style.top = 0;
        this.style.left = 0;
        this.style.width = "100%";
        this.style.height = "100%";
      }
    }
    window.customElements.define(OpenCard.is, OpenCard);
  </script>
</dom-module>