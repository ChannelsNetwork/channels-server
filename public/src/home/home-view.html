<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../logo/channels-logo.html">
<link rel="import" href="../app-icons.html" async>

<dom-module id="home-view">
  <template>
    <style is="custom-style" include="app-styles iron-flex iron-flex-alignment">
       :host {
        display: block;
      }

      .view {
        min-height: 100vh;
        box-sizing: border-box;
        @apply --layout-horizontal;
        @apply --layout-center;
      }

      .panel {
        padding: 15px;
      }

      .vectorPanel {
        text-align: center;
        -ms-flex: 1 1 0.000000001px;
        -webkit-flex: 1;
        flex: 1;
        -webkit-flex-basis: 0.000000001px;
        flex-basis: 0.000000001px;
      }

      #logo {
        margin: 0 auto;
        width: 400px;
        height: 400px;
        vertical-align: middle;
      }

      .content {
        font-size: 18px;
        max-width: 650px;
      }

      .content.centered {
        margin: 0 auto;
      }

      #textPanel {
        max-width: 650px;
        opacity: 0;
        transform: translateX(50px);
        transition: all 1s ease;
        box-sizing: border-box;
      }

      h3 {
        margin-bottom: 20px;
      }

      .cell {
        padding: 20px 16px;
        box-sizing: border-box;
      }

      em {
        color: var(--highlight-blue);
        font-weight: bold;
        font-style: normal;
      }

      iron-icon {
        width: 32px;
        height: 32px;
        display: block;
        color: #000;
        margin: 0 auto;
      }

      #fab {
        position: fixed;
        bottom: 67px;
        right: 41px;
        background: var(--bg-yellow);
        outline: none;
        width: 56px;
        height: 56px;
        margin: 0;
        padding: 0;
        cursor: pointer;
        border-radius: 100%;
        box-shadow: 0 0 3px rgba(0, 0, 0, 0.12), 0 3px 3px rgba(0, 0, 0, 0.24), 0 0 6px rgba(0, 0, 0, 0.12), 0 6px 6px rgba(0, 0, 0, 0.24);
        box-sizing: border-box;
        overflow: hidden;
        white-space: nowrap;
        transition: all 0.2s ease-out;
        z-index: 90;
        transform: translate3d(0px, 0px, 0px);
      }

      a.button {
        background: var(--button-yellow);
        color: #000;
        padding: 5px 8px;
        border-radius: 3px;
      }

      @media (max-width: 850px) {
        #logo {
          width: 280px;
          height: 280px;
        }

        .vectorPanel {
          -ms-flex: 0;
          -webkit-flex: 0;
          flex: 0;
        }
      }

      @media (max-width: 650px) {
        .view2 {
          @apply --layout-vertical;
        }

        h1 {
          font-size: 40px;
        }

        h3 {
          font-size: 26px;
        }

        #logo {
          width: 100px;
          height: 100px;
        }

        .vectorPanel {
          width: 100%;
          box-sizing: border-box;
          text-align: left;
        }

        .content {
          font-size: 16px;
          line-height: 1.35;
        }

        #fab {
          bottom: 24px;
          right: 16px;
        }
      }
    </style>
    <section id="p1" class="view view2">
      <div id="logoPanel" class="vectorPanel panel">
        <channels-logo hidden id="logo"></channels-logo>
      </div>
      <div class="flex panel">
        <div id="textPanel" class="content">
          <h1>Channels</h1>
          <h3>A content network fueled by cryptocurrency</h3>
          <p>
            We want a place to get absorbed in an eclectic mix of information and entertainment, and where the presentation can be just
            as engaging as the content.
          </p>
          <p>
            We believe this is possible with an open platform where people who create good stuff get paid well for it.
          </p>
          <p>This is Channels and is coming this fall.</p>
          <p>
            <a href="/whitepaper.pdf" target="_blank">Read our whitepaper</a>
          </p>
          <p><a href="https://twitter.com/channelscc" target="_blank">Follow us on Twitter</a></p>
          <section id="sec1">
            <p>
              We'll be releasing shortly.
            </p>
            <p>
              <a class="button" href="#register">Reserve your ChannelCoin</a>
            </p>
          </section>
          <section id="sec2" style="display: none;">
            <p>You're already registered with Channels!</p>
            <p>
              <a class="button" href="#balance">View your balance</a>
            </p>
          </section>
        </div>
      </div>
    </section>
    <section id="p2" class="view" style="background: #38262f;">
      <div class="flex cell">
        <div class="content centered">
          <h3>Content</h3>
          <p>
            As a consumer you will come here to find engaging information and entertainment -- <em>videos, photos,
            stories, games, and more</em>. Anyone will be able to publish content here and set their own price on it.
          </p>
          <p>
            Advertisers can enter an auction to determine the price they must <em>pay consumers who see their content</em>.
          </p>
          <p>
            Channels makes sure that consumers see the <em>fewest and best ads</em> that pay enough to cover the costs of
            the content they choose to buy.
          </p>
        </div>
    </section>
    <section id="p3" class="view" style="background: #26382f;">
      <div class="flex cell">
        <div class="content centered">
          <h3>ChannelCoin</h3>
          <p>
            Unlike Google and Facebook, the two largest ad networks, Channels does not participate as a middleman in these transactions.
          </p>
          <p>
            Every ad a consumer sees is backed by a tiny <em>transaction directly between the advertiser and the consumer</em>.
            Every post a consumer opens results in a small transaction between the consumer and the one who posted that content.
          </p>
          <p>
            These transactions are frictionless and anonymous. And all of this is possible because we use a new cryptocurrency called
            <em>ChannelCoin</em>. Advertisers will buy these coins. Content producers will sell these coins.
          </p>
          <p>
            The market will determine the fair market value of the content and advertising space based on the price of this currency.
          </p>
        </div>
    </section>
    <section id="p4" class="view" style="background: #2f2638;">
      <div class="flex cell">
        <div class="content centered">
          <h3>Open and Transparent</h3>
          <p>
            Channels is an <em>open-source network</em>. Unlike the big players today who shroud their systems in secrecy,
            we think consumers, advertisers, and content producers value transparency -- <em>understanding where the money is coming from, where
            it is going to, and why</em>.
          </p>
          <p>Users in this network remain anonymous, but auctions and transactions are all transparent.</p>
        </div>
    </section>
    <section id="p5" class="view" style="background: #242426;">
      <div class="flex cell">
        <div class="content centered" style="text-align: center;">
          <div style="padding: 0 0 60px;">
            <a id="bottomReserve" class="button" href="#register">Reserve your ChannelCoin</a>
            <a id="bottomBalance" style="display: none;" class="button" href="#balance">View your balance</a>
          </div>
          <h3>Want to learn even more?</h3>
          <p><a href="/whitepaper.pdf" target="_blank">Read our whitepaper</a></p>
          <p><a href="https://twitter.com/channelscc" target="_blank">Follow us on Twitter</a></p>
          <p><a href="https://medium.com/channels-network" target="_blank">Check out our blog</a></p>
        </div>
      </div>
    </section>
    <button id="fab" title="More" on-click="_more"><iron-icon icon="[[fabIcon]]"></iron-icon></button>
  </template>
  <script>
    class HomeView extends Polymer.Element {
      static get is() { return 'home-view'; }
      static get properties() {
        return {
          fabIcon: {
            type: String,
            value: "ch:expand-more"
          }
        };
      }

      onActivate() {
        setTimeout(() => {
          this.$.textPanel.style.opacity = 1;
          this.$.textPanel.style.transform = "none";
        }, 1);
        setTimeout(() => {
          this.$.logo.hidden = false;
        }, 100);
        if ($core.hasKey) {
          this.$.sec2.style.display = "";
          this.$.sec1.style.display = "none";
          this.$.bottomBalance.style.display = "";
          this.$.bottomReserve.style.display = "none";
        } else {
          this.$.sec2.style.display = "none";
          this.$.sec1.style.display = "";
          this.$.bottomBalance.style.display = "none";
          this.$.bottomReserve.style.display = "";
        }

        if (!this._scrollHandler) {
          this._scrollHandler = () => {
            this._onScroll();
          };
          $app.shell.addEventListener("scroll", this._scrollHandler);
        }

        this._goingDown = true;
        $app.shell.scrollTop = 0;
        this.set("fabIcon", "ch:expand-more");
      }

      onDeactivate() {
        if (this._scrollHandler) {
          $app.shell.removeEventListener("scroll", this._scrollHandler);
          this._scrollHandler = null;
        }
      }

      _more() {
        let sizes = [
          this.$.p1.getBoundingClientRect(), this.$.p2.getBoundingClientRect(),
          this.$.p3.getBoundingClientRect(), this.$.p4.getBoundingClientRect(),
          this.$.p5.getBoundingClientRect()
        ];
        let winh = window.innerHeight;
        let index = 0;
        for (var i = 0; i < sizes.length; i++) {
          let top = sizes[i].top;
          if (top > (winh * 0.1)) {
            index = i;
            break;
          }
        }
        this._animateScroll(sizes[index].top);
      }

      _onScroll() {
        let winh = window.innerHeight;
        let threshold = this.$.p5.getBoundingClientRect().top;
        var goingDown = threshold > (winh * 0.1);
        if (this._goingDown != goingDown) {
          this._goingDown = goingDown;
          this.set("fabIcon", goingDown ? "ch:expand-more" : "ch:expand-less");
        }
      }

      _animateScroll(offset) {
        var iv = $app.shell.scrollTop;
        var diff = offset;
        this._animStart = 0;
        this._step = (timestamp) => {
          if (!this._animStart) {
            this._animStart = timestamp;
          }
          let progress = Math.min(1, Math.max(0, (timestamp - this._animStart) / 400));
          $app.shell.scrollTop = iv + (diff * progress);
          if (progress < 1) {
            window.requestAnimationFrame(this._step);
          }
        };
        window.requestAnimationFrame(this._step);
      }
    }
    window.customElements.define(HomeView.is, HomeView);
  </script>
</dom-module>