<link rel="import" href="../controls/user-image.html">

<dom-module id="account-view">
  <template>
    <style is="custom-style" include="app-styles">
      :host {
        display: block;
      }

      #container {
        max-width: 400px;
        margin: 0 auto;
        padding: 20px 16px;
      }

      #imagePanel {
        padding-right: 20px;
      }

      .header {
        margin-bottom: 20px;
      }

      .row {
        margin-top: 10px;
      }

      label {
        font-size: 90%;
        text-transform: capitalize;
        padding-right: 10px;
        letter-spacing: 0.05em;
        opacity: 0.87;
        width: 75px;
      }

      .buttons {
        padding: 40px 0 10px;
      }

      @media (max-width: 490px) {
        .row {
          font-size: 14px;
        }
        user-image {
          width: 70px;
          height: 70px;
        }
        .buttons {
          text-align: center;
        }
      }
    </style>
    <div id="container">
      <div class="horizontal layout center header">
        <div id="imagePanel">
          <user-image image="[[profile.image]]"></user-image>
        </div>
        <div class="flex">
          <h2>[[profile.name]]</h2>
          <em>[[profile.handle]]</em>
        </div>
      </div>
      <div class="row horizontal layout center">
        <label>Email: </label>
        <div class="flex">[[profile.email]]</div>
      </div>
      <div class="row horizontal layout center">
        <label>Address: </label>
        <div class="flex">[[profile.address]]</div>
      </div>
      <div class="buttons">
        <button style="margin-right: 10px;" on-click="_onEdit">Edit profile</button>
        <button on-click="_onSignOut">Sign out</button>
      </div>
    </div>
  </template>
  <script>
    class AccountView extends Polymer.Element {
      static get is() { return 'account-view'; }
      static get properties() {
        return {
          profile: Object
        };
      }

      onActivate() {
        this.profile = {};
        $core.register().then((info) => {
          if (!$core.profile || !$core.profile.handle) {
            setTimeout(() => {
              $router.goto("");
              return;
            }, 600);
            return;
          }
          const profile = {
            handle: 'No handle',
            name: 'No name specified',
            email: 'No email provided',
            address: $core.address || 'Unknown address'
          };
          let p = $core.profile;
          if (p) {
            if (p.handle) {
              profile.handle = p.handle;
            }
            if (p.name) {
              profile.name = p.name;
            }
            if (p.emailAddress) {
              profile.email = p.emailAddress;
            }
            if (p.imageUrl) {
              profile.image = p.imageUrl;
            }
          }
          this.profile = profile;
        }).catch((err) => {
          console.error(err);
          setTimeout(() => {
            $router.goto("");
          }, 600);
        });
      }

      _onEdit() {
        $router.goto("/edit-profile");
      }

      _onSignOut() {
        $core.signOut().then(() => {
          $router.goto("");
        }).catch((err) => {
          console.error(err);
          $router.goto("");
        })
      }

    }
    window.customElements.define(AccountView.is, AccountView);
  </script>
</dom-module>