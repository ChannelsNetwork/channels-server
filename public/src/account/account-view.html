<link rel="import" href="../../bower_components/soso-app-header/soso-app-header.html">
<link rel="import" href="../app/channels-bar.html">
<link rel="import" href="../app/title-bar.html">
<link rel="import" href="../controls/user-image.html">

<dom-module id="account-view">
  <template>
    <style is="custom-style" include="app-styles">
      :host {
        display: block;
      }

      #container {
        max-width: 600px;
        margin: 0 auto;
        padding: 20px 16px;
        text-align: center;
      }

      .buttons {
        padding: 40px 0 10px;
      }

      user-image {
        width: 120px;
        height: 120px;
        margin-bottom: 20px;
      }

      .handle {
        color: #555;
        font-size: 16px;
        letter-spacing: 0.05em;
      }

      .email {
        color: #555;
        font-size: 16px;
        letter-spacing: 0.05em;
        margin-top: 15px;
      }
    </style>
    <soso-app-header collapse-height="50">
      <channels-bar id="cbar"></channels-bar>
      <title-bar text="My Account"></title-bar>
    </soso-app-header>
    <div id="container">
      <user-image image="[[profile.image]]"></user-image>
      <h2>[[profile.name]]</h2>
      <div class="handle">([[profile.handle]])</div>
      <div class="email">[[profile.email]]</div>
      <div class="buttons">
        <button style="margin-right: 10px;" on-click="_onEdit">Edit profile</button>
        <button on-click="_onSignOut">Sign out</button>
      </div>
    </div>
  </template>
  <script>
    class AccountView extends Polymer.Element {
      static get is() { return 'account-view'; }
      static get properties() {
        return {
          profile: Object
        };
      }

      onActivate() {
        this.profile = {};
        $core.register().then((info) => {
          this.$.cbar.activate();
          if (!$core.profile || !$core.profile.handle) {
            setTimeout(() => {
              $router.goto("");
              return;
            }, 600);
            return;
          }
          const profile = {
            handle: 'No handle',
            name: 'No name specified',
            email: 'No email provided',
            address: $core.address || 'Unknown address'
          };
          let p = $core.profile;
          if (p) {
            if (p.handle) {
              profile.handle = p.handle;
            }
            if (p.name) {
              profile.name = p.name;
            }
            if (p.emailAddress) {
              profile.email = p.emailAddress;
            }
            if (p.image && p.image.url) {
              profile.image = p.image.url;
            }
          }
          this.profile = profile;
        }).catch((err) => {
          console.error(err);
          setTimeout(() => {
            $router.goto("");
          }, 600);
        });
      }

      onDeactivate() {
        this.$.cbar.deactivate();
      }

      _onEdit() {
        $router.goto("/edit-profile");
      }

      _onSignOut() {
        $core.signOut().then(() => {
          window.location.assign("/");
        }).catch((err) => {
          console.error(err);
          window.location.assign("/");
        })
      }

    }
    window.customElements.define(AccountView.is, AccountView);
  </script>
</dom-module>