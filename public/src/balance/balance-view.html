<dom-module id="balance-view">
  <template>
    <style is="custom-style" include="app-styles iron-flex iron-flex-alignment">
       :host {
        display: block;
        background: #37474F;
        min-height: 100vh;
      }

      .content {
        padding: 30px 15px 20px;
        max-width: 600px;
        margin: 0 auto;
        position: relative;
        box-sizing: border-box;
        font-size: 20px;
      }

      .balancePanel {
        padding: 30px 0 10px;
      }

      .balance {
        display: inline-block;
        background: var(--bg-yellow);
        color: #000;
        font-size: 36px;
        padding: 10px 20px;
        border-radius: 5px;
        text-align: left;
        line-height: 1.2;
        min-width: 250px;
        box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      label {
        font-size: 20px;
        display: block;
        margin-bottom: 8px;
        letter-spacing: 0.05em;
      }

      .footer {
        margin-top: 80px;
        font-size: 16px;
      }

      @media (max-width: 600px) {
        .content {
          padding: 10px 15px;
        }
        .balancePanel {
          padding: 15px 0 10px;
        }
        .footer {
          margin-top: 20px;
        }
      }
    </style>
    <div class="barspace"></div>
    <div class="content">
      <p>
        You have ChannelCoins waiting for you when you get started. You'll be able to use these to pay for content, to promote your
        own content, or to trade in for cash
      </p>
      <div class="balancePanel">
        <div id="balanceCard" class="balance">
          <label>Balance</label>
          <div>[[balance]]</div>
        </div>
      </div>
      <div class="footer">
        <p>Want to earn extra coins for you and your friends?</p>
        <p>
          <a on-click="onInvite">Invite a friend</a>
        </p>
      </div>
    </div>
  </template>
  <script>
    class BalanceView extends Polymer.Element {
      static get is() { return "balance-view"; }
      static get properties() {
        return {
          balance: String
        };
      }

      onActivate() {
        if (!$core.hasKey) {
          setTimeout(() => {
            $router.goto("");
          }, 600);
          return;
        }
        $core.register().then((info) => {
          this.$.balanceCard.style.opacity = 1;
          const at = Date.now();
          const initial = info.status.userBalance || 0;
          this.balanceTimer = setInterval(() => {
            this.balance = "â„‚" + $core.balance.toFixed(8);
          }, 250);
        }).catch((err) => {
          console.error(err);
          setTimeout(() => {
            $router.goto("");
          }, 600);
        });
      }

      onInvite() {
        $router.goto("invite", { returnPage: "balance" });
      }

      onDeactivate() {
        if (this.balanceTimer) {
          clearInterval(this.balanceTimer);
          this.balanceTimer = null;
        }
      }
    }
    window.customElements.define(BalanceView.is, BalanceView);
  </script>
</dom-module>